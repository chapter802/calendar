!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Calendar=e()}(this,function(){"use strict";function t(){}function e(t,e){for(var a in e)void 0!==e[a]&&(t[a]=e[a]);return t}function a(t){var e=+t;return e<10&&(e="0"+e),e}function s(t){return!(t%(t%100?4:400))}function n(t,e){var a={"y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),"S+":t.getMilliseconds()};for(var s in a)if(new RegExp("("+s+")").test(e))if("y+"===s)e=e.replace(RegExp.$1,(""+a[s]).substr(4-RegExp.$1.length));else if("S+"===s){var n=RegExp.$1.length;n=1===n?3:n,e=e.replace(RegExp.$1,("00"+a[s]).substr((""+a[s]).length-1,n))}else e=e.replace(RegExp.$1,1===RegExp.$1.length?a[s]:("00"+a[s]).substr((""+a[s]).length));return e}function i(t){var e=12,s=T+t;s>e&&(s=e);var n=b[s-1].days;return S+"-"+a(s)+"-"+a(n)}function r(){return{data:b,text:{holiday:"休",workday:"班"},el:document.body,start:S+"-"+a(T)+"-"+a(N),end:i(6),startCallback:t,endCallback:t,selectDate:{},maxDays:!1,maxCallback:t}}var l=function(t){var e=t||new Date;return{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()}},o=function(){return'<ul class="calendar-bar"><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ul>'},h=function(t){return'<h1 class="calendar-title">'+t+"</h1>"},d=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return e?'<li data-index="'+n+'" data-date="'+s+'" class="'+t+'"><span class="calendar-text">'+e+'</span><span class="calendar-remark">'+a+"</span></li>":'<li class="'+t+'"></li>'},c=function(t,e){return'<div class="calendar-day-select select-'+e+'"><span class="day">'+t+'</span><span class="text">'+("start"===e?"入住":"离店")+'</span><div class="elem-proxy"></div></div>'},u={days:31,fest:{1:"元旦",5:"腊八",20:"小年",27:"除夕",28:"春节"},holidays:{1:!0,2:!0,27:!0,28:!0,29:!0,30:!0,31:!0},workdays:{22:!0}},y={days:s((new Date).getFullYear())?29:28,fest:{11:"元宵节",14:"情人节"},holidays:{1:!0,2:!0},workdays:{4:!0}},f={days:31,fest:{8:"妇女节"},holidays:{},workdays:{}},v={days:30,fest:{4:"清明节"},holidays:{2:!0,3:!0,4:!0,29:!0,30:!0},workdays:{1:!0}},m={days:31,fest:{1:"劳动节",14:"母亲节",30:"端午节"},holidays:{1:!0,28:!0,29:!0,30:!0},workdays:{27:!0}},g={days:30,fest:{1:"儿童节",18:"父亲节"},holidays:{},workdays:{}},D={days:31,fest:{1:"建党节"},holidays:{},workdays:{}},p={days:31,fest:{1:"建军节",28:"七夕节"},holidays:{},workdays:{}},k={days:30,fest:{5:"中元节",10:"教师节"},holidays:{},workdays:{30:!0}},E={days:31,fest:{1:"国庆节",4:"中秋节",28:"重阳节",31:"万圣节"},holidays:{1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},workdays:{}},x={days:30,fest:{23:"感恩节"},holidays:{},workdays:{}},w={days:31,fest:{24:"平安夜",25:"圣诞节"},holidays:{},workdays:{}},b=[u,y,f,v,m,g,D,p,k,E,x,w],M=l(),S=M.year,T=M.month,N=M.day,C=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},H=function(){function t(t,e){for(var a=0;a<e.length;a++){var s=e[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,a,s){return a&&t(e.prototype,a),s&&t(e,s),e}}(),L=function(){function t(a){C(this,t),this.options=e(r(),a),this.el=this.options.el,this.data=this.options.data,this.startDate=new Date(this.options.start),this.endDate=new Date(this.options.end),this.isMoving=!1,this.touchStartTime=null,this.start={},this.end={},this.selectDayElems=[]}return H(t,[{key:"init",value:function(){var t=this,e=this.create();this.render(e),setTimeout(function(){t.attachEvent();var e=t.options.selectDate,a=e.start,s=e.end;a&&s&&t.selectDate(a,s)},10)}},{key:"create",value:function(){var t=this.createMonths(),e=o();return"\n      "+e+'\n      <div class="calendar-items">\n        '+t+"\n      </div>\n    "}},{key:"createMonths",value:function(){var t=this,e=this.startDate.getFullYear(),s=this.startDate.getMonth()+1,n=this.endDate.getMonth()+1,i=this.data.map(function(i,r){var l=r+1;if(!i.days||s>l||n<l)return"";var o=h(e+"年"+a(l)+"月"),d=t.createDays(e,l);return'<section class="calendar-month">'+o+'<ul class="calendar-days">'+d+"</ul></section>"});return i.join("")}},{key:"createDays",value:function(t,e){var s=new Date(t,e-1,1),n=l().day,i=this.data[e-1],r=s.getDay(),o=r,h=[];for(this.data[e-1].preDayCount=r;o-- >0;)h.push(d("disabled","",""));for(var c=1;c<=i.days;){var u=t+"-"+a(e)+"-"+a(c),y=this.dayType(t,e,c),f=i.fest[c]||c;this.isCurMonth(t,e)&&c<n?y+=" disabled":this.isToday(t,e,c)&&(y+=" today",f="今天");var v=this.isHoliday(e,c)?this.options.text.holiday:this.isWorkDay(e,c)?this.options.text.workday:"",m=c+r-1;h.push(d(y.trim(),f,v,u,m)),c++}return h.join("")}},{key:"render",value:function(t){var e=document.createElement("div");e.className="calendar-content",e.innerHTML=t,this.contentEl=e,this.el.appendChild(e)}},{key:"attachEvent",value:function(){this.contentEl.addEventListener("touchstart",this,!1),this.contentEl.addEventListener("touchmove",this,!1),this.contentEl.addEventListener("touchend",this,!1)}},{key:"handleEvent",value:function(t){var e=this;switch(t.type){case"touchstart":e.touchstart(t);break;case"touchmove":e.touchmove(t);break;case"touchend":e.touchend(t)}}},{key:"touchstart",value:function(t){this.touchStartTime=Date.now()}},{key:"touchmove",value:function(t){this.touchStartTime=0}},{key:"touchend",value:function(e){var a=Date.now()-this.touchStartTime;if(!(a>500)){var s=e.target,n=s.getAttribute("data-date");if(n)this.chooseDay(s,n);else{var i=t.getParent(s),r=i.getAttribute("data-date");if(r)this.chooseDay(i,r);else{var l=t.getParent(i),o=l.getAttribute("data-date");o&&this.chooseDay(l,o)}}}}},{key:"chooseDay",value:function(e,a){if(e.className.indexOf("disabled")===-1){this.start.html&&this.end.html&&this.reset();var s=+e.getAttribute("data-index"),n=e.innerHTML,i=new Date(a),r=i.getMonth()+1,o=i.getDate();if(this.start.index===s)this.reset();else if(this.start.html){var h=this.start.date.getMonth()+1,d=t.getParent(e),u=d.getElementsByTagName("li");if(r!==h){if(r<h)return!1;if(!this.isValidMaxDays(this.start.date,i))return this.options.maxCallback.call(this,this.start.date,i),!1;var y=t.getParent(this.start.el),f=y.getElementsByTagName("li");this.end={html:n,date:i,index:s,el:e},e.innerHTML=c(o,"end"),this.findSelectDayElems(f,this.start.index,f.length-1);for(var v=l(),m=r-h,g=this.el.querySelectorAll(".calendar-days"),D=1;D<m;D++){var p=g[h-v.month+D].getElementsByTagName("li");this.findSelectDayElems(p,0,p.length-1)}this.findSelectDayElems(u,0,s),this.selectDayStyle({type:"add",className:"active"})}else{if(this.start.index>s)return!1;if(!this.isValidMaxDays(this.start.date,i))return this.options.maxCallback.call(this,this.start.date,i),!1;this.end={html:n,date:i,index:s,el:e},e.innerHTML=c(o,"end"),this.findSelectDayElems(u,this.start.index,s),this.selectDayStyle({type:"add",className:"active"})}this.options.endCallback.call(this,i,this.getSelectNumberOfDays(this.start.date,i))}else this.start={html:n,date:i,index:s,el:e},e.innerHTML=c(o,"start"),this.options.startCallback.call(this,i)}}},{key:"isValidMaxDays",value:function(t,e){return"boolean"==typeof this.options.maxDays||this.getSelectNumberOfDays(t,e)<this.options.maxDays}},{key:"getSelectNumberOfDays",value:function(t,e){var a=l(t),s=a.month,n=a.day,i=l(e),r=i.month,o=i.day;return s===r?o-n:this.data[s-1].days-n+o}},{key:"selectDate",value:function(t,e){this.start.html&&this.end.html&&this.reset();var a=this.startDate.getMonth()+1,s=this.el.querySelectorAll(".calendar-days"),n=new Date(t),i=n.getMonth()+1,r=n.getDate(),l=r+this.data[i-1].preDayCount-1,o=s[i-a].getElementsByTagName("li"),h=new Date(e),d=h.getMonth()+1,c=h.getDate(),u=c+this.data[d-1].preDayCount-1,y=o[l],f=null;if(i!==d){var v=s[d-a].getElementsByTagName("li"),m=d-i;f=v[u],this.findSelectDayElems(o,l,o.length-1);for(var g=1;g<m;g++){var D=s[i-a+g].getElementsByTagName("li");this.findSelectDayElems(D,0,D.length-1)}this.findSelectDayElems(v,0,u)}else f=o[u],this.findSelectDayElems(o,l,u);this.selectDayStyle({type:"add",className:"active"}),this.setDayState(y,"start",l),this.setDayState(f,"end",u)}},{key:"reset",value:function(){this.start.el.innerHTML=this.start.html,this.end.html&&(this.end.el.innerHTML=this.end.html),this.start={},this.end={},this.selectDayStyle({type:"remove",className:"active"}),this.selectDayElems=[]}},{key:"findSelectDayElems",value:function(e,a,s){var n=this;t.forEach(e,function(t,e){return!(e>s)&&(e>=a&&e<=s&&n.selectDayElems.push(t),!0)})}},{key:"selectDayStyle",value:function(e){t.forEach(this.selectDayElems,function(t,a,s){return 0!==a&&a!==s-1&&t.classList[e.type](e.className),!0})}},{key:"setDayState",value:function(t,e,a){var s=new Date(t.getAttribute("data-date")),n=s.getDate();this[e]={html:t.innerHTML,date:s,index:a,el:t},t.innerHTML=c(n,e)}},{key:"dayType",value:function(t,e,a){var s=[];return this.isHoliday(e,a)&&s.push("holiday"),this.isFest(e,a)&&s.push("fest"),this.isWeekend(t,e,a)&&s.push("weekend"),this.isWorkDay(e,a)&&s.push("workday"),s.join(" ")}},{key:"isHoliday",value:function(t,e){return this.data[t-1].holidays[e]}},{key:"isWorkDay",value:function(t,e){return this.data[t-1].workdays[e]}},{key:"isFest",value:function(t,e){return this.data[t-1].fest[e]}},{key:"isWeekend",value:function(t,e,s){var n=e-1,i=new Date(t,a(n),a(s)),r=i.getDay();return 0===r||6===r}},{key:"isCurMonth",value:function(t,e){var a=l(),s=a.year,n=a.month;return t===s&&e===n}},{key:"isToday",value:function(t,e,a){var s=l(),n=s.year,i=s.month,r=s.day;return t===n&&e===i&&a===r}}],[{key:"getParent",value:function(t){var e=t.parentNode;return!(!e||11===e.nodeType)&&e}},{key:"forEach",value:function(t,e){var a=0,s=t.length;for(a;a<s&&e(t[a],a,s);a++);}},{key:"format",value:function(t,e){return n(t,e)}}]),t}();return L});
